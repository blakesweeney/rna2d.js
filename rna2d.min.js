(function(){var a=window.Rna2D||function(b){var c=function(e){if(e){c.selection(e)}var d=a.views[c.view()];d.coordinates(c);d.connections(c);d.groups(c);d3.select(c.selection()).call(function(f){c.nucleotides.computeOrder();f.select("svg").remove();c.vis=f.append("svg").attr("width",c.width()).attr("height",c.height());c.coordinates(function(g){g.attr("id",c.nucleotides.getID()).attr("class",function(j,h){return c.nucleotides["class"]()+" "+c.nucleotides.classOf()(j,h)}).attr("data-sequence",c.nucleotides.getSequence());a.utils.attachHandlers(g,c.nucleotides);return g});c.connections(function(g){var h=c.interactions.getNTs(),i=c.interactions.visible();g.attr("id",c.interactions.getID()).attr("class",function(k,j){return c.interactions["class"]()+" "+c.interactions.classOf()(k,j)}).attr("visibility",function(j){j.__visibility=i(j);return(i(j)?"visible":"hidden")}).attr("data-nts",function(k,j){return h(k).join(",")}).attr("nt1",function(k,j){return h(k)[0]}).attr("nt2",function(k,j){return h(k)[1]});a.utils.attachHandlers(g,c.interactions);return g});c.groups(function(g){var h=c.motifs.getNTs();g.attr("id",c.motifs.getID()).attr("class",function(k,j){return c.motifs["class"]()+" "+c.motifs.classOf()(k,j)}).attr("data-nts",function(i){return c.motifs.getNTs()(i).join(",")}).datum(function(k,j){k.__visible=c.motifs.visible()(k,j);return k}).attr("visibility",function(i){return(i.__visible?"visible":"hidden")});a.utils.attachHandlers(g,c.motifs);return g});c.components();return c})};a.config(c,b);a.components(c);return c};window.Rna2D=a;a.components=function(d){d.components=function(){for(var e in d.components){d.components[e](d)}};for(var b in a.components){var c=a.components[b];(function(e){var f=null;d[e]=function(g){if(!arguments.length){return f}f=g;return d[e]}})(b);if(typeof(c.config)==="function"){c.config=c.config(d)}a.utils.generateAccessors(d[b],c.config);if("sideffects" in c){c.sideffects(d)}}d.components[b]=function(g){for(var e in a.components){var f=a.components[e];if("actions" in f){f.actions(g)}if("generate" in f){f.generate(g)}}return g};return a};a.config=function(c,d){var b={labels:[],margin:{left:10,right:10,above:10,below:10},view:"circular",width:500,height:1000,selection:null,xScale:null,yScale:null};a.utils.extend(b,d);a.utils.generateAccessors(c,b);return c};a.utils=function(){var b={};b.distance=function(d,c){return Math.sqrt(Math.pow(c.x-d.x,2)+Math.pow(c.y-d.y,2))};b.generateAccessors=function(d,c,e){d3.keys(c).forEach(function(f){d[f]=function(){return function(g){if(!arguments.length){return c[f]}var h=c[f];c[f]=g;if(e&&e[f]){e[f](h,g)}return d}}()})};b.attachHandlers=function(d,e){var c=["click","mouseover","mouseout"];if(e.mouseover()==="highlight"){c=[c[0]];d.on("mouseover",e.highlight()).on("mouseout",e.normalize())}c.forEach(function(f){if(e[f]){d.on(f,e[f]())}});return d};b.extend=function(e,c){for(var d in c){e[d]=c[d]}return e};b.element=function(c){return document.getElementById(c)};return b}();a.views={airport:{},circular:{}};a.components.brush=function(){var d,c,b;return{config:{enabled:true,initial:[],"class":"brush",update:Object,clear:Object},actions:function(e){e.brush.select=function(f){d();e.brush().extent(f);c();e.vis.select("."+e.brush["class"]()).call(e.brush());b();return e.brush};e.brush.enable=function(){e.vis.append("g").classed(e.brush["class"](),true).call(e.brush());e.brush.enabled(true);return e.brush};e.brush.disable=function(){e.vis.selectAll("."+e.brush["class"]()).remove();e.brush.enabled(false);return e.brush};e.brush.toggle=function(){if(e.brush.enabled()){return e.brush.disable()}return e.brush.enable()}},generate:function(e){d=function(){return"bobo"};c=function(f){};b=function(){var f={};if(e.brush().empty()){e.brush.clear()}else{var h=e.brush().extent(),g=e.nucleotides.getID();e.vis.selectAll("."+e.nucleotides["class"]()).attr("checked",function(i){if(h[0][0]<=i.__x&&i.__x<=h[1][0]&&h[0][1]<=i.__y&&i.__y<=h[1][1]){f[g(i)]=i}});e.brush.update()(f)}};e.brush(d3.svg.brush().on("brushstart",d).on("brush",c).on("brushend",b).x(e.xScale()).y(e.yScale()));if(e.brush.initial().length){e.brush.select(e.brush.initial())}if(e.brush.enabled()){e.brush.enable()}return e.brush}}}();a.components.frame={config:{add:true,"class":"frame"},generate:function(b){if(!b.frame.add()){return b.vis}return b.vis.append("svg:rect").classed(b.frame["class"](),true).attr("x",0).attr("y",0).attr("width",b.width()).attr("height",b.height()-1).style("pointer-events","none")}};a.components.interactions=function(){return{config:function(b){return{getFamily:function(c){return c.family},getNTs:function(c){return[c.nt1,c.nt2]},visible:function(e){var c=b.interactions.getFamily()(e);return c==="cWW"||c==="ncWW"},mouseover:null,mouseout:null,click:null,"class":"interaction",classOf:function(c){return c.family},highlightColor:function(){return"red"},highlight:Object,normalize:Object,isForward:function(f){var c=b.interactions.getFamily(),e=c(f);if(e.length==3){e=e.slice(1,3).toUpperCase()}else{e=e.slice(2,4).toUpperCase()}return e=="WW"||e=="WH"||e=="WS"||e=="HH"||e=="SH"||e=="SS"},isSymmetric:function(g,e){var c=b.interactions.getFamily(),f=c(g);return f[1]==f[2]},getID:function(f){var c=b.interactions.getFamily()(f),e=b.interactions.getNTs()(f);if(b.interactions.isSymmetric()(f)){e.sort()}e.push(c);return e.join("-")},color:"black"}},sideffects:function(b){b.interactions.valid=function(){var g=b.interactions(),l=b.interactions.getID(),f=b.interactions.getNTs(),n=b.interactions.isForward(),c=[],d={},j=b.nucleotides.ordered();for(var h=0;h<g.length;h++){var m=g[h],e=l(m,h),k=f(m);if(n(m)&&!d[e]&&k.length&&j[k[0]]&&j[k[1]]){d[e]=true;c.push(m)}}return c}},actions:function(b){b.interactions.all=function(c){if(!arguments.length||!c){c=b.interactions["class"]()}return b.vis.selectAll("."+c)};b.interactions.family=function(c){return b.interactions.getFamily()(d3.select(c).datum())};b.interactions.nucleotides=function(e){if(!arguments.length){e=this}var d=e.getAttribute("data-nts").split(","),c="#"+d.join(", #");return b.vis.selectAll(c)};b.interactions.show=function(c){return b.interactions.all(c).attr("visibility",function(d){d.__visibility=true;return"visible"})};b.interactions.hide=function(c){return b.interactions.all(c).attr("visibility",function(d){d.__visibility=false;return"hidden"})};b.interactions.toggle=function(c){return b.interactions.all(c).attr("visibility",function(d){if(d.__visibility){d.__visibility=false;return"hidden"}d.__visibility=true;return"visible"})}}}}();a.components.jmol={config:{divID:"jmol",appID:"jmolApplet0",tmpID:"tempJmolToolsObj",neighborhoodID:"neighborhood",numbersID:"showNtNums",stereoID:"stero",maxSize:200,overflow:Object,windowSize:400,windowBuild:function(b){b.append('<label><input type="checkbox" id="showNtNums">Numbers</label>').append('<input type="button" id="neighborhood" value="Show neighborhood">').append('<input type="button" id="stereo" value="Stereo">')}},sideffects:function(b){b.jmol.setup=function(){var c=$("#"+b.jmol.appID()),d=$("#"+b.jmol.divID());if(c.length===0){d.html(jmolApplet(b.jmol.windowSize(),"",0));b.jmol.windowBuild()(d);d.show()}jmolScript("zap;");$.jmolTools.numModels=0;$.jmolTools.stereo=false;$.jmolTools.neighborhood=false;$("#"+b.jmol.neighborhoodID()).val("Show neighborhood");$.jmolTools.models={};$("#"+b.jmol.stereoID()).unbind();$("#"+b.jmol.neighborhoodID()).unbind();$("#"+b.jmol.numbersID()).unbind();return b.jmol};b.jmol.showSelection=function(c){b.jmol.setup();var f=c;if(typeof(c)=="object"){var d=$.map(c,function(h,g){return g});f=d.join(",")}var e=f.split(",").length;if(e>b.jmol.maxSize()){return b.jmol.overflow()}$("#"+b.jmol.tmpID()).remove();$("body").append("<input type='radio' id='"+b.jmol.tmpID()+"' data-coord='"+f+"'>");$("#"+b.jmol.tmpID()).hide();$("#"+b.jmol.tmpID()).jmolTools({showNeighborhoodId:b.jmol.neighborhoodID(),showNumbersId:b.jmol.numbersID(),showStereoId:b.jmol.stereoID()}).jmolToggle();return b.jmol};b.jmol.showGroup=function(c){if(!arguments.length||!c){c=this}b.jmol.showSelection(c.getAttribute("data-nts"))}}};a.components.labels={config:{majorTickClass:"major-tick",minorTickClass:"minor-tick",labelClass:"label",width:5,fontSize:12,majorTickCount:30,majorTickGenerator:function(b){var c=d3.scale.identity().domain([1,plot.nucleotides().length+1]).range([1,plot.nucleotides().length+1]);return c.ticks(plot.labels.majorTickCount())},minorTickCount:150,minorTickGenerator:function(b){var c=d3.scale.identity().domain([1,plot.nucleotides().length+1]).range([1,plot.nucleotides().length+1]);return c.ticks(plot.labels.minorTickCount())}}};a.components.motifs=function(){return{config:{classOf:function(b){return b.id.split("_")[0]},"class":"motif",highlightColor:function(){return"red"},visible:function(b){return true},click:null,mouseover:null,mouseout:null,getID:function(b){return b.id},getNTs:function(b){return b.nts},highlight:Object,normalize:Object},actions:function(b){b.motifs.all=function(){return b.vis.selectAll("."+b.motifs["class"]())};b.motifs.nucleotides=function(e){var d=e.getAttribute("data-nts").split(",");var c="#"+d.join(", #");return b.vis.selectAll(c)};b.motifs.show=function(){var c=b.motifs.visible();return b.motifs.all().datum(function(f,e){f.__visible=c(f,e);return f}).attr("visibility",function(f,e){return(f.__visible?"visible":"hidden")})};b.motifs.hide=function(){var c=b.motifs.visible();return b.motifs.all().datum(function(f,e){f.__visible=c(f,e);return f}).attr("visibility",function(f,e){return(f.__visible?"hidden":"visible")})};b.motifs.toggle=function(){var c=b.motifs.visible();b.motifs.all().datum(function(f,e){f.__visible=!f.__visible;return f}).attr("visibility",function(f,e){return(f.__visible?"visible":"hidden")})}}}}();a.components.nucleotides=function(){var b={};return{config:{highlightColor:function(){return"red"},"class":"nucleotide",classOf:function(e,c){return""},color:"black",fontSize:11,gap:1,click:null,mouseover:null,mouseout:null,getID:function(c){return c.id},getX:function(c){return c.x},getY:function(c){return c.y},getSequence:function(c){return c.sequence},highlight:Object,normalize:Object},sideffects:function(c){c.nucleotides.computeOrder=function(){var f=c.nucleotides(),e=c.nucleotides.getID();for(var d=0;d<f.length;d++){var g=e(f[d]);b[e(f[d])]=d}return c.nucleotides};c.nucleotides.indexOf=function(d){return b[d]};c.nucleotides.ordered=function(d){if(!arguments.length){return b}b=d;return c.nucleotides}},actions:function(c){c.nucleotides.all=function(){return c.vis.selectAll("."+c.nucleotides["class"]())};c.nucleotides.interactions=function(e){if(!arguments.length){e=this}var d="[nt1="+e.getAttribute("id")+"], [nt2="+e.getAttribute("id")+"]";return c.vis.selectAll(d)};c.nucleotides.doColor=function(){return c.nucleotides.all().attr("fill",c.nucleotides.color())}}}}();a.views.airport.connections=function(c){var b=function(p,o,m){var h=p.getBBox(),g=o.getBBox(),s=h.x,f=h.y,q=g.x,e=g.y,l=q-s,k=e-f,i=0.004;var x=function(d){return(d<0?-1:1)},j=function(d){return{x:d.x+d.width/2,y:d.y+d.height/2}},n=function(d,r){return Math.sqrt(Math.pow(d,2)+Math.pow(r,2))};if(Math.abs(k)<i){f=f+h.height/2;if(s<q){return{x:s+h.width+m,y:f}}return{x:s-m,y:f}}if(Math.abs(l)<i){s=s+h.width/2;if(f>e){return{x:s,y:f+m}}return{x:s,y:f+h.height+m}}m=1;var u=j(h),t=n(l,k),w=x(l)*Math.abs(l*m/t),v=x(k)*n(m,w);return{x:u.x+w,y:u.y+v}};c.connections=function(k){var e=c.interactions.valid(),d=c.interactions.getNTs();for(var j=0;j<e.length;j++){var g=e[j],l=d(g),h=a.utils.element(l[0]),f=a.utils.element(l[1]),n=b(h,f,c.nucleotides.gap()),m=b(f,h,c.nucleotides.gap());g.line={x1:n.x,y1:n.y,x2:m.x,y2:m.y}}c.vis.selectAll(c.interactions["class"]()).data(e).enter().append("svg:line").call(k).attr("stroke",c.interactions.color()).attr("x1",function(i){return i.line.x1}).attr("y1",function(i){return i.line.y1}).attr("x2",function(i){return i.line.x2}).attr("y2",function(i){return i.line.y2});return c};c.interactions.highlight(function(){var d=this,e=c.interactions.highlightColor();d3.select(d).style("stroke",e(d));return c.interactions.nucleotides(d).style("stroke",e(d))});c.interactions.normalize(function(){var d=this;d3.select(d).style("stroke",null);return c.interactions.nucleotides(d).style("stroke",null)});return a};a.views.airport.coordinates=function(b){b.coordinates=function(i){var h=b.nucleotides(),c=b.width(),m=b.height(),g=b.margin();var l=d3.max(h,function(n){return n.x}),f=d3.max(h,function(n){return n.y}),j=d3.max([c,l]),e=d3.max([m,f]),k=d3.scale.linear().domain([-g.right,j+g.left]).range([0,c]),d=d3.scale.linear().domain([-g.above,e+g.below]).range([0,m]);b.xScale(k);b.yScale(d);b.__xCoordMax=l;b.__yCoordMax=f;b.vis.selectAll(b.nucleotides["class"]()).data(h).enter().append("svg:text").call(i).attr("x",function(p,o){var n=k(b.nucleotides.getX()(p,o));p.__x=n;return n}).attr("y",function(o,n){var p=d(b.nucleotides.getY()(o,n));o.__y=p;return p}).attr("font-size",b.nucleotides.fontSize()).attr("fill",b.nucleotides.color()).text(b.nucleotides.getSequence()).attr("fill",b.nucleotides.color());return b};b.nucleotides.highlight(function(){var c=this,d=b.nucleotides.highlightColor();d3.select(c).style("stroke",d());return b.nucleotides.interactions(c).style("stroke",d())});b.nucleotides.normalize(function(){var c=this;d3.select(c).style("stroke",null);return b.nucleotides.interactions(c).style("stroke",null)});return a};a.views.airport.groups=function(b){b.groups=function(l){var r=b.motifs();if(!r||!r.length){return b}for(var k=0;k<r.length;k++){var n=r[k],g=0,q=b.__xCoordMax,o=b.__yCoordMax,c=0,f=b.motifs.visible();n.visible=f(n);var m=b.motifs.getNTs()(n);for(var h=0;h<m.length;h++){var d=m[h],e=a.utils.element(d);if(e===null){console.log("Missing nt "+d+" in motif: ",n);break}var s=e.getBBox();if(s.x<q){q=s.x}if(s.x+s.width>g){g=s.x+s.width}if(s.y+s.height>c){c=s.y+s.height}if(s.y<o){o=s.y}n.bounding=[{x:g,y:o},{x:g,y:c},{x:q,y:c},{x:q,y:o}]}}var p=d3.svg.line().x(function(i){return i.x}).y(function(i){return i.y});b.vis.selectAll(b.motifs["class"]()).data(b.motifs()).enter().append("svg:path").call(l).attr("d",function(i){return p(i.bounding)+"Z"});return b};b.motifs.highlight(function(){var c=this,d=b.motifs.highlightColor();return b.motifs.nucleotides(c).style("stroke",d(c))});b.motifs.normalize(function(){var c=this;return b.motifs.nucleotides(c).style("stroke",null)});return a};a.views.circular.connections=function(b){b.connections=function(d){var e=b.interactions.getNTs();var g=d3.svg.arc().outerRadius(b.__ntArc.innerRadius()()).innerRadius(b.__ntArc.innerRadius()()-3).startAngle(b.__ntArc.startAngle()).endAngle(b.__ntArc.endAngle());var c=function(j){var h=g.centroid(null,b.nucleotides.indexOf(j)),i=b.__circleCenter;return{x:i.x+h[0],y:i.y+h[1]}};var f=function(o,j){var n=g.startAngle(),l=e(o),p=c(l[0]),q=c(l[1]),h=a.utils.distance(p,q),m=n(null,b.nucleotides.indexOf(l[0]))-n(null,b.nucleotides.indexOf(l[1])),k=g.innerRadius()()*Math.tan(m/2),r=0;if(b.nucleotides.indexOf(l[0])>b.nucleotides.indexOf(l[1])){r=1}return"M "+p.x+" "+p.y+" A "+k+","+k+" "+0+" "+0+" "+r+" "+q.x+","+q.y};b.vis.selectAll(b.interactions["class"]()).data(b.interactions.valid()).enter().append("path").call(d).attr("d",f).attr("fill","none").attr("stroke",b.interactions.color());return b};b.interactions.highlight(function(){var d=this,e=b.interactions.highlightColor(),c=b.interactions.nucleotides(d);d3.select(d).style("stroke",e(d));b.pie.addLetters()(c[0]);return c.style("stroke",e(d))});b.interactions.normalize(function(){var c=this;d3.select(c).style("stroke",null);b.pie.clearLetters()();b.interactions.nucleotides(c).style("stroke",null);return b.interactions});return a};a.views.circular.coordinates=function(c){c.coordinates=function(l){var j=10*Math.min(c.margin().left,c.margin().right),q=c.width()/2-j,r=q-c.pie.width(),e={x:c.width()/2,y:c.height()/2},n=c.nucleotides().length,p=(2*Math.PI-c.pie.gapSize())/n,d=c.pie.gapSize()/2,o=function(t,s){return s*p+d},h=function(t,s){return(s+1)*p+d};var f=d3.svg.arc().outerRadius(q).innerRadius(r).startAngle(o).endAngle(h);var m=c.nucleotides();for(var k=0;k<m.length;k++){var g=f.centroid(null,k);m[k].__x=e.x+g[0];m[k].__y=e.y+g[1]}c.vis.selectAll(c.nucleotides["class"]()).append("g").data(c.nucleotides()).enter().append("svg:path").call(l).attr("d",f).attr("transform","translate("+e.x+","+e.y+")").attr("fill",c.nucleotides.color());c.__ntArc=f;c.__circleCenter=e;c.xScale(d3.scale.identity().domain([0,c.width()])).yScale(d3.scale.identity().domain([0,c.height()]));return c};c.nucleotides.highlight(function(){var d=this,e=c.nucleotides.highlightColor();d3.select(d).style("stroke",e(d));c.pie.addLetters()([d]);return c.nucleotides.interactions(d).style("stroke",e(d))});c.nucleotides.normalize(function(){var d=this;d3.select(d).style("stroke",null);c.pie.clearLetters()();return c.nucleotides.interactions(d).style("stroke",null)});c.pie={};var b={width:10,gapSize:0.2,letterClass:"nucleotide-letter",letterID:function(d){return d.getAttribute("id")+"-letter"},letterSize:20,letterPosition:function(f){var e=c.nucleotides.indexOf(f.getAttribute("id")),d=c.__ntArc.centroid(null,e);return{x:c.__circleCenter.x+d[0],y:c.__circleCenter.y+d[1]}},addLetters:function(e){var d=c.pie.letterPosition(),f=c.nucleotides.highlightColor();c.vis.selectAll(c.pie.letterClass()).data(e).enter().append("svg:text").attr("id",c.pie.letterID()).attr("class",c.pie.letterClass()).attr("x",function(g){return d(g).x}).attr("y",function(g){return d(g).y}).attr("font-size",c.pie.letterSize()).attr("pointer-events","none").text(function(g){return g.getAttribute("data-sequence")}).attr("fill",function(g){return f(g)});return c.pie},clearLetters:function(){c.vis.selectAll("."+c.pie.letterClass()).remove()}};a.utils.generateAccessors(c.pie,b);return a};a.views.circular.groups=function(b){b.groups=function(c){return b};return a}})();